## Практическое задание №10

1. Настроить iBGP в офисом Москва между маршрутизаторами R14 и R15.
2. Настроить iBGP в провайдере Триада, с использованием RR.
3. Настроить сеть офиса Москва так, чтобы приоритетным провайдером стал Ламас.
4. Настроить сеть офиса С.-Петербург так, чтобы трафик до любого офиса распределялся по двум линкам одновременно.


### 1. Настроить iBGP в офисом Москва между маршрутизаторами R14 и R15.
Для настройки iBGP соседства для передачи маршрутной информации можно установить TCP сессию между физическими интерфейсами e1/0 роутеров 
R14 и R15. Но это не надежно, по причине если пропадет линк, то пропадет и iBGP соседство между R14 и R15, а вместе с ним и информация о маршрутах.
Конечно можно установить дополнительное BGP соседство через транзитные роутеры R12 и R13. В таком случае соседсво на R14
будет выглядеть так

![R14 sh_ip_bgp_sum.png](R14%20sh_ip_bgp_sum.png)

А так выглядит список маршрутов в базе BGP.

![R14 sh_ip_bgp.png](R14%20sh_ip_bgp.png)

Видно, что получены маршруты по iBGP (internal), все они valid, а лучшим выбран прямой маршрут R14-R15.

Но есть более элегантное решение.
В качестве интерфейсов для установления соседства по BGP использовать TCP сессию установленную между интерфейсами Loopback0
роутеров R14 и R15. Виртуальный сетевой интерфейс будет доступен всегда, а надежность связанности между Loopback интерфейсами 
R14 и R15 обеспечивается избыточностью связей Backbone area OSPF.

Запускаем процесс OSPF на интерфейсах Loopbak0 R14, R15. Покажем на примере R14.
````
R14(config)#int loopback 0
R14(config-if)#ip ospf 1 area 0
````
Теперь настраиваем процесс iBGP на роутерах одновременно для IPv4 и IPv6.
````
R14(config)#router bgp 1001
R14(config-router)#neighbor 192.168.0.15 remote-as 1001
R14(config-router)#neighbor 192.168.0.15 update-source loopback 0
R14(config-router)#neighbor 203a:bb8a:d701:8888::15 remote-as 1001
R14(config-router)#address-family ipv4
R14(config-router-af)#neighbor 192.168.0.15 next-hop-self
R14(config-router-af)#address-family ipv6
R14(config-router-af)#neighbor 203a:bb8a:d701:8888::15 activate
R14(config-router-af)#neighbor 203a:bb8a:d701:8888::15 next-hop-self
````
Меньше соседей и меньше записей маршрутов в базе BGP.  

![R14 sh_ip_bgp_sum_lo0.png](R14%20sh_ip_bgp_sum_lo0.png)

![R14 sh_ip_bgp_lo0.png](R14%20sh_ip_bgp_lo0.png)

Маршрутная информация получена, а в качестве Next Hop указан IPv4 адрес Loopback0 R15.

### 2. Настроить iBGP в провайдере Триада, с использованием RR.

Для начала настроим eBGP между Киторн и Триада, которую не учли в предыдущей работе.

















